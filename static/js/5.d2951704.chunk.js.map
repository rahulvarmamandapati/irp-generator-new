{"version":3,"sources":["services/hooks/write.js","images/bg-blue-spheres-pattern.jpg"],"names":["fetchProfile","id","resProfile","doc","db","getDoc","profileData","data","addNewProfile","stateProfile","statePersona","personaId","personaRef","addDoc","collection","profiles","newProfileRef","persona_id","profile_id","created_at","Timestamp","now","setDoc","updateDoc","arrayUnion","personasDocRef","personasDocSnap","personasDataRef","persona","Promise","all","map","personaData","updated_at","profile","updateProfile","profileRef","personasRef","removeProfile","savedProfile","savedPersona","deleteDoc","arrayRemove","personasData","length","initialState"],"mappings":"iQAiBMA,EAAY,iDAAG,WAAOC,GAAP,sFACdA,EADc,0CACH,GADG,cAEbC,EAAaC,YAAIC,IAAI,WAAYH,GAFpB,SAGOI,YAAOH,GAHd,cAGbI,EAHa,yBAIZA,EAAYC,QAJA,2CAAH,sDAOLC,EAAa,iDAAG,WAAOC,EAAcC,GAArB,uGAGvBA,EAAaT,GAHU,gBAIzBU,EAAYD,EAAaT,GACzBW,EAAaT,YAAIC,IAAI,WAAYO,GALR,sCAONE,YAAOC,YAAWV,IAAI,YAAa,CACpDW,SAAU,KARa,OAOzBH,EAPyB,OAUzBD,EAAYC,EAAWX,GAVE,cAarBe,EAAgBb,YAAIW,YAAWV,IAAI,aACnCE,EAdqB,2BAetBG,GAfsB,IAgBzBQ,WAAYN,EACZO,WAAYF,EAAcf,GAC1BkB,WAAYC,IAAUC,QAlBG,UAoBrBC,YAAON,EAAeV,GApBD,yBAqBrBiB,YAAUX,EAAY,CAC1BG,SAAUS,YAAWR,EAAcf,MAtBV,eAwBrBwB,EAAiBtB,YAAIC,IAAI,WAAYO,GAxBhB,UAyBGN,YAAOoB,GAzBV,eAyBrBC,EAzBqB,iBA2BGrB,YAAOO,GA3BV,eA2BrBe,EA3BqB,OA4BrBC,EAAUD,EAAgBpB,OA5BL,UA6BJsB,QAAQC,IAC7BF,EAAQb,SAASgB,IAAjB,iDAAqB,WAAO9B,GAAP,oGAAcD,EAAaC,IAA3B,2CAArB,wDA9ByB,eA6BrBc,EA7BqB,OAgCrBiB,EAhCqB,2BAiCtBtB,GAjCsB,IAkCzBT,GAAIU,EACJI,SAAUW,EAAgBnB,OAAOQ,SACjCkB,WAAYb,IAAUC,QApCG,UAsCrBE,YAAUE,EAAgBO,GAtCL,iCAuCpB,CACLE,QAAS5B,EACTS,WACAa,QAASI,IA1CgB,4CAAH,wDA8CbG,EAAa,iDAAG,WAAO1B,EAAcC,GAArB,0FACtBD,EAAaQ,YAAeR,EAAaS,WADnB,0CACsC,GADtC,cAErBkB,EAAajC,YAAIC,IAAI,WAAYK,EAAaS,YAC9CZ,EAHqB,2BAItBG,GAJsB,IAKzBwB,WAAYb,IAAUC,QAElBgB,EAAclC,YAAIC,IAAI,WAAYK,EAAaQ,YAC/Ce,EARqB,2BAStBtB,GATsB,IAUzBuB,WAAYb,IAAUC,QAVG,SAYrBE,YAAUa,EAAY9B,GAZD,wBAarBiB,YAAUc,EAAaL,GAbF,iCAepB,CACLE,QAAS5B,EACTsB,QAASI,IAjBgB,4CAAH,wDAqBbM,EAAa,iDAAG,WAAOC,EAAcC,GAArB,gGAErBJ,EAAajC,YAAIC,IAAI,WAAYmC,EAAarB,YAE9CN,EAAaT,YAAIC,IAAI,WAAYoC,EAAavC,IAJzB,SAMrBwC,YAAUL,GANW,uBAQrBb,YAAUX,EAAY,CAC1BG,SAAU2B,YAAYH,EAAarB,cATV,uBAcAb,YAAOO,GAdP,cAcrB+B,EAdqB,OAerBf,EAAUe,EAAapC,OAfF,UAgBJsB,QAAQC,IAC7BF,EAAQb,SAASgB,IAAjB,iDAAqB,WAAO9B,GAAP,oGAAcD,EAAaC,IAA3B,2CAArB,wDAjByB,mBAgBrBc,EAhBqB,kBAmBtBA,KAAU6B,OAnBY,kCAoBnBH,YAAUtC,YAAIC,IAAI,WAAYQ,EAAWX,KApBtB,iCAqBlB,CACLiC,QAASW,IAAaX,QACtBnB,SAAU8B,IAAa9B,SACvBa,QAASiB,IAAajB,UAxBC,iCA2BpB,CACLM,QAASW,IAAaX,QACtBnB,WACAa,QAAQ,2BACHY,GADE,IAELvC,GAAIuC,EAAavC,GACjBc,SAAUa,EAAQb,aAjCK,4CAAH,yD,q1xBC3FX,QAA0B","file":"static/js/5.d2951704.chunk.js","sourcesContent":["import {\n  collection,\n  doc,\n  getDoc,\n  addDoc,\n  setDoc,\n  updateDoc,\n  Timestamp,\n  arrayUnion,\n  deleteDoc,\n  arrayRemove,\n  // query,\n  // where,\n} from 'firebase/firestore';\nimport { db } from '../../firebase';\nimport { initialState } from '../../contexts/stepperContext';\n\nconst fetchProfile = async (id) => {\n  if (!id) return false;\n  const resProfile = doc(db, 'profiles', id);\n  const profileData = await getDoc(resProfile);\n  return profileData.data();\n};\n\nexport const addNewProfile = async (stateProfile, statePersona) => {\n  let personaRef;\n  let personaId;\n  if (statePersona.id) {\n    personaId = statePersona.id;\n    personaRef = doc(db, 'personas', personaId);\n  } else {\n    personaRef = await addDoc(collection(db, 'personas'), {\n      profiles: [],\n    });\n    personaId = personaRef.id;\n  }\n\n  const newProfileRef = doc(collection(db, 'profiles'));\n  const profileData = {\n    ...stateProfile,\n    persona_id: personaId,\n    profile_id: newProfileRef.id,\n    created_at: Timestamp.now(),\n  };\n  await setDoc(newProfileRef, profileData); // saves profile data\n  await updateDoc(personaRef, {\n    profiles: arrayUnion(newProfileRef.id),\n  });\n  const personasDocRef = doc(db, 'personas', personaId);\n  const personasDocSnap = await getDoc(personasDocRef);\n\n  const personasDataRef = await getDoc(personaRef);\n  const persona = personasDataRef.data();\n  const profiles = await Promise.all(\n    persona.profiles.map(async (id) => fetchProfile(id)),\n  );\n  const personaData = {\n    ...statePersona,\n    id: personaId,\n    profiles: personasDocSnap.data().profiles,\n    updated_at: Timestamp.now(),\n  };\n  await updateDoc(personasDocRef, personaData); // saves profile data\n  return {\n    profile: profileData,\n    profiles,\n    persona: personaData,\n  };\n};\n\nexport const updateProfile = async (stateProfile, statePersona) => {\n  if (!stateProfile.persona_id && !stateProfile.profile_id) return false;\n  const profileRef = doc(db, 'profiles', stateProfile.profile_id);\n  const profileData = {\n    ...stateProfile,\n    updated_at: Timestamp.now(),\n  };\n  const personasRef = doc(db, 'personas', stateProfile.persona_id);\n  const personaData = {\n    ...statePersona,\n    updated_at: Timestamp.now(),\n  };\n  await updateDoc(profileRef, profileData); // saves profile data\n  await updateDoc(personasRef, personaData); // saves profile data\n\n  return {\n    profile: profileData,\n    persona: personaData,\n  };\n};\n\nexport const removeProfile = async (savedProfile, savedPersona) => {\n  // get profile doc to be deleted\n  const profileRef = doc(db, 'profiles', savedProfile.profile_id);\n  // get persona doc that holds profile id to be deleted\n  const personaRef = doc(db, 'personas', savedPersona.id);\n  // delete profile doc\n  await deleteDoc(profileRef);\n  // // Atomically remove deleted profile from the \"profiles\" array field.\n  await updateDoc(personaRef, {\n    profiles: arrayRemove(savedProfile.profile_id),\n  });\n  // NOT 100% SURE THIS WORKS - IF PROFILES ARRAY IS EMPTY, DELETE PERSONA DOC\n  // const personaCol = await collection(db, personaRef);\n  // const q = query(personaRef, where('profiles', '==', true));\n  const personasData = await getDoc(personaRef);\n  const persona = personasData.data();\n  const profiles = await Promise.all(\n    persona.profiles.map(async (id) => fetchProfile(id)),\n  );\n  if (!profiles?.length) {\n    await deleteDoc(doc(db, 'personas', personaRef.id));\n    return {\n      profile: initialState.profile,\n      profiles: initialState.profiles,\n      persona: initialState.persona,\n    };\n  }\n  return {\n    profile: initialState.profile,\n    profiles,\n    persona: {\n      ...savedPersona,\n      id: savedPersona.id,\n      profiles: persona.profiles,\n    },\n  };\n};\n","export default __webpack_public_path__ + \"static/media/bg-blue-spheres-pattern.7b0715d5.jpg\";"],"sourceRoot":""}